---
layout: post
---
#对等网络

Peer-to-Peer Networks (P2P)

##对等计算模型

- 每个节点都有一些资源（处理能力、存储空间、网络带宽、内容等）可以提供给其它节点。
- 节点之间直接共享资源，不需要服务器参与。
- 所有节点地位相等（称对等方），具备客户和服务器双重特性。
- 可缓解集中式结构的问题，充分利用终端的丰富资源。

##P2P技术的应用

提供文件或其他内容共享，如：Napster, Gnutella, eDonkey, emule, BitTorrent等。

BitTorrent是最流行的P2P文件共享系统之一：

- 种子节点（保存完整的文件拷贝）把一个文件分成N个分片（默认为256KB）；
- 节点X从种子节点随机下载第L个分片，Y随机下载第M个分片，然后节点X与Y交换彼此拥有的分片；
- 减轻了种子节点的负担，提高了节点下载的速度与效率。

P2P媒体网：

- P2P流媒体的直播与点播；
- 网上实时电视；
- 流行的软件包括：Coolstreaming, AnySee, Gridmedia, PPLive和PPStream等。

基于P2P方式的协同处理与服务共享平台：

- P2P技术将众多终端空闲的CPU资源联合起来，服务于一个共同的计算；
- 计算任务划分成多个分片，分配到参与计算的P2P节点上；计算结果返回给一个或多个服务器；众多结果整合得到最终结果；
- 搜索外星文明的SETI@home科学实验。

即时通信交流：

- VoIP是一种全新的网络电话通信业务，如Skype

##P2P系统的定义

P2P系统是一个由直接相连的节点所构成的分布式系统，这些节点能够为了共享内容、CPU时间、存储或者带宽等资源而自组织形成一定的网络拓扑结构，能够在适应节点数目的变化和失效的同时维持可以接受的连接能力和性能，并且不需要一个全局服务器或者权威的中介支持。

##P2P网络的拓扑结构

P2P系统的主要概念之一是分散，包括分布式存储、处理、信息共享和控制信息。

根据P2P系统的分散程度，可以将P2P架构分成纯分散式和混合式。

根据结构关系可以将P2P系统细分为四种拓扑形式：
- 中心化拓扑
- 全分布式非结构化拓扑
- 全分布式结构化拓扑
- 半分布式拓扑

##P2P网络的资源发现机制

- 中性化结构：集中式索引和存储
- 分布式非结构化：查询请求的洪泛广播
- 分布式结构化：内容可寻址网络

###集中式索引和存储

一个集中的目录服务器保存所有资源的位置和使用信息：
- 网络中所有文件的元数据（文件名、创建时间等）索引；
- 登录用户的连接信息表（IP地址、连接速度等）；
- 每个用户拥有并愿意共享的文件列表。 

起始时，客户与目录服务器建立连接，报告其保存的文件列表。

当目录服务器收到来自用户的查询时，查找索引表，返回存有所需文件的用户列表。

用户选择其中一个对等方建立直接连接，下载文件。 

###查询请求的洪泛广播

洪泛查询的过程：

- 在覆盖网络上，查询节点将一个资源发现请求发送给与其直接相连的所有节点；
- 这些节点再向其直接相连的邻居洪泛该请求；
- ... ...
- 直到请求被响应或达到最大洪泛次数。

###内容可寻址网络

分布式P2P系统的核心是一个将文件名映射到文件存放位置的索引系统。

查找服务通过将对等节点组织到一个有结构的覆盖网络中，并将消息通过覆盖网络路由到相关对等节点来实现。

**Content-Addressable Network (CAN)**

CAN类似于一张大哈希表，基本操作包括插入、查找和删除<关键字，值>对：

- 关键字可能是部分或完整的文件名；
- 值可能为获取该文件所需的信息（如大小、位置等）。

网络中每个节点保存哈希表的一块。

对一个特定关键字的请求（插入、查找或删除）由中间CAN节点路由到包含该关键字的目标CAN节点。

##P4P技术

###P2P贷款吞噬问题

- P2P流量已经占到整个互联网流量的50%左右，且仍在持续增长。 
- P2P流量大量占用宝贵的骨干网带宽资源，尤其是互联互通出口及国际出口的带宽，极大地增加了投资成本压力，并造成运营成本上升。
- 用户正常的上网业务的服务质量难以得到有效保障。

###带宽吞噬问题的根源——P2P的交换机制

P2P过于强调对等，它对资源在网络中的位置不作区分，一律平等地返回给用户，而用户随机选择一个节点交换。

节点之间的交换完全是无序的，无序的交换导致无谓的跨地区甚至是跨国的“流量旅行”，耗费了宝贵的国内和国际带宽资源。 

###基于ISP的流量控制

目前因特网上的流量控制主要是ISP的责任：

应用给出网络流的目的地址及流量需求模式，ISP根据当前网络状态确定最有效的路由。

P2P模式改变了传统的流量控制问题：

- 应用需要的数据可以从很多节点、以很多种方式得到，每一种方式都会产生一种不同的流量需求模式并导致不同的网络使用效率。
- P2P的动态流量模式能够自动适应网络变化，但也使得ISP估计网络状态并确定最佳路由的努力无效。

###基于ISP和P2P应用合作的P4P技术

P4P：Proactive network Provider Participation for P2P

网络运营商和P2P应用应合作解决流量吞噬问题。

P4P是一个允许网络运营者向新型应用显式提供网络信息、策略及能力的通用框架，除P2P之外可支持各种高带宽应用。

P4P由控制面、管理面和数据面组成：
- 数据面（可选）：区分应用流和设定应用流的优先级
- 控制面：通过iTracker向应用提供网络信息
- 管理面：监视控制面的行为 

##搭便车现象及抑制机制

节点只享受服务而不为系统做贡献的行为称为搭便车（free riding），大量搭便车现象将导致P2P网络效用大幅降低。

P2P网络中还存在大量不可靠的服务以及欺诈行为。

必须考虑P2P网络中节点的自主行为，激励节点之间有效合作并合理使用网络资源。

###搭便车行为对对等网络的哦影响

大量搭便车节点可能使热心节点因长期过载而宕机，导致整个对等网络的连通性发生巨大变化。

大量搭便车行为会降低对等网络的生命周期：热心节点因得不到资源而离开网络，并带走大量的资源，导致更多的节点离开。

如果搭便车现象过于严重，对等网络将趋近客户机/服务器通信模式，其可用性甚至比传统的客户机/服务器通信模式更差。 

###搭便车行为抑制机制

抑制搭便车行为的共同指导原则是：根据节点已作出的贡献，确定它能够享受服务的能力。

- 基于节点行为的激励机制
- 基于博弈论的方法
- 采用社会网络或经济模型的控制策略

**博弈论方法**

博弈论是分析社会群体和经济活动中，个体和群体选择最优行为策略的有效数学工具。 

利用博弈论方法建模，一个节点的行为选择与同时在线的其它节点的行为选择紧密相关。 

节点在对等网络中的行为可以建模为长期博弈过程，节点可在包括热心为系统做贡献、贪婪下载、贡献收益平衡等多种行为策略集合中找到有利于最大化自身收益的策略选择。


