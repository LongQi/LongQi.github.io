---
layout: post
---
#分布式系统之一致性

##一致性简介

###复制的目的

两个：

- 可靠性，当一个副本被破坏后，可以维护多个拷贝，来提供更好的保护；
- 性能，分布式系统需要在服务器数量和地理区域上进行扩展时，复制对于提高性能是相当重要的。

进行数据复制需要付出一定的代价，复制所带来的问题是多个拷贝可能导致一致性方面的问题。

###对象复制

###作为扩展技术的复制

一方面，可扩展性问题可以通过采用复制和缓存技术得到缓解，而另一方面，保持所有拷贝的一致性通常要求全局同步，而全局同步必然造成性能的严重下降。

唯一可行的解决方法是放宽在一致性方面的限制，一致性可被放宽的程度主要取决于复制数据的访问和更新模式，同时还取决于这些数据的用途。

##以数据为中心的一致性模型

通常，总是在讨论共享数据的读操作和写操作时讨论一致性的问题。这些共享数据是通过分布式共享存储器、分布式共享数据库或分布式文件系统实现的。

假设每个可以访问数据存储中的数据的进程都有整个数据存储的一个本地或邻近的拷贝，写操作将传播到其他拷贝。

###严格一致性 strict consistency

对于数据项x的任何读操作将返回最近一次对x进行的写操作的结果所对应的值。

严格一致性中存在的问题是它依赖于绝对的全局时间。对于所有的进程来说，所有写操作都是瞬间可见的，系统维持着一个绝对的全局时间顺序。如果一个数据项被改变了，那么无论数据项改变之后多久执行读操作，无论哪些进程执行读操作，无论这些进程的位置如何，所有在该数据项上执行的后续读操作都将得到新数值。

###线性化和顺序一致性

尽管严格一致性是理想的一致性模型，但是在分布式系统中，它无法实现。

顺序一致性（sequential consistency）：任何执行结果都是相同的，就好像所有进程对数据存储的读、写操作是按某种序列顺序执行的，并且每个进程的操作按照程序所指定的顺序出现在这个序列中。

一种弱于严格一致性但又强于顺序一致性的一致性模型是线性化。这种模型假设操作具有一个全局有效时钟的时间戳，但是这个时钟仅具有有限的精确度。要求时间戳在前的进程先执行。线性化是根据一系列同步时钟确定序列顺序的。

###因果一致性 causal consistency

当一个读操作后面跟着一个写操作时，这两个事件就具有潜在的因果关系，同样，读操作也与为读操作提供数据的写操作因果相关。没有因果关系的操作被称为并发的。

所有进程必须以相同的顺序看到具有潜在因果关系的写操作，不同机器上的进程可以以不同的顺序被看到并发的写操作。

实现因果一致性要求跟踪哪些进程看到了哪些写操作。这就意味着必须构建和维护一张记录哪些操作依赖于哪些操作的依赖关系图。一种实现方法是向量时间戳。

###FIFO一致性

所有进程以某个单一进程提出写操作的顺序看到这些写操作，但是不同进程可以以不同的顺序看到不同进程提出的写操作。

###弱一致性 weak consistency

引入同步变量S，其仅有一个关联操作synchronize(S)，该操作同步数据存储的所有本地拷贝。

使用同步变量来部分地定义一致性就得到称为弱一致性模型，其具有三个属性：

- 对数据存储所关联的同步变量的访问是顺序一致的；
- 每个拷贝完成所有先前执行的写操作之前，不允许对同步变量进行任何操作；
- 所有先前对同步变量执行的操作都执行完毕之前，不允许对数据项进行任何读或写操作。

###释放一致性 release consistency

提供两种类型的同步变量：

- 获取acquire操作，是用于通知数据存储进程进入临界区的操作；
- 释放release操作，是表明进程刚刚离开临界区的操作。

###入口一致性





